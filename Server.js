/* ------------------------- Acquiring Dependancies ------------------------- */
const express = require("express");
const mongoose = require("mongoose");
const routers = require("./Routers/routers");
const middleWares = require("./MiddleWares/middleWares");
/* -------------------------------------------------------------------------- */

/* ----------------------------- Starting Server ---------------------------- */
server = express();
mongoose.connect(process.env.dbURL).then(()=>{
    console.log("Connected to Database!");
    server.listen(process.env.PORT || 8000, ()=>{
        console.log("Server is running!");
    });
}).catch(()=>{
    console.log("Failed to Connect to Database!");
});
/* -------------------------------------------------------------------------- */


/* -------------------------------------------------------------------------- */
/*                            Creating MiddleWares                            */
/* -------------------------------------------------------------------------- */

    /* ----------------------------- Cors MiddleWare ---------------------------- */
    server.use(routers.corsParser);
    /* -------------------------------------------------------------------------- */
    
    /* ---------------------------- Logger MiddleWare --------------------------- */
    server.use(middleWares.logger);
    /* -------------------------------------------------------------------------- */

    /* ------------------------- Body Parser MiddleWare ------------------------- */
    server.use(routers.bodyParser);
    /* -------------------------------------------------------------------------- */
    
    /* --------------------------- Testing MiddleWare --------------------------- */
    server.use(middleWares.testRequest);
    /* -------------------------------------------------------------------------- */
    
    /* -------------------------- Registeration Router -------------------------- */
    server.use(routers.registerRouter.routerStudent);
    server.use(routers.registerRouter.routerSpeaker);
    /* -------------------------------------------------------------------------- */

    /* ------------------------ Authentication MiddleWare ----------------------- */
    server.use(routers.authRouter);
    /* -------------------------------------------------------------------------- */


        /* -------------------------------------------------------------------------- */
        /*                               Adding Routers                               */
        /* -------------------------------------------------------------------------- */


        /* ------------------------------ Event Routes ------------------------------ */
        server.use(routers.eventRouter);
        /* -------------------------------------------------------------------------- */

        /* ----------------------------- Student Routes ----------------------------- */
        server.use(routers.studentRouter);
        /* -------------------------------------------------------------------------- */

        /* ----------------------------- Speaker Routes ----------------------------- */
        server.use(routers.speakerRouter);
        /* -------------------------------------------------------------------------- */


        /* -------------------------------------------------------------------------- */
        /*                               End of Routers                               */
        /* -------------------------------------------------------------------------- */


    /* -------------------------- Not Found MiddleWare -------------------------- */
    server.use(middleWares.notFoundHandler);
    /* -------------------------------------------------------------------------- */

    /* ---------------------------- Error MiddleWare ---------------------------- */
    server.use(middleWares.errorHandler);
    /* -------------------------------------------------------------------------- */

    
/* -------------------------------------------------------------------------- */
/*                             End of MiddleWares                             */
/* -------------------------------------------------------------------------- */